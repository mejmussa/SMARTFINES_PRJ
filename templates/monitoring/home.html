{% extends "monitoring/base.html" %}
{% block content %}
    <main class="container-fluid mt-3 px-3">
        {% if messages %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {% for message in messages %}
            {{ message }}
            {% endfor %}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-5 g-4 mb-4">
            <div class="col">
                <a href="{% url 'vehicle_list' %}" class="dash-item">
                    <i class="fas fa-car icon"></i>
                    <h3>{{ total_vehicles }}</h3>
                    <p>Vehicles <span class="visit-icon"><i class="fas fa-arrow-right"></i></span></p>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'balance_history' %}" class="dash-item">
                    <i class="fas fa-wallet icon"></i>
                    <h3>{{ total_balance|floatformat:2 }}</h3>
                    <p>Balance <span class="visit-icon"><i class="fas fa-arrow-right"></i></span></p>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'pending_offenses' %}" class="dash-item">
                    <i class="fas fa-clock icon"></i>
                    <h3>{{ pending_offenses }}</h3>
                    <p>Pending <span class="visit-icon"><i class="fas fa-arrow-right"></i></span></p>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'paid_offenses' %}" class="dash-item">
                    <i class="fas fa-check-circle icon" style="color: #28a745;"></i>
                    <h3>{{ paid_offenses }}</h3>
                    <p>Paid <span class="visit-icon"><i class="fas fa-arrow-right"></i></span></p>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'penalty_offenses' %}" class="dash-item">
                    <i class="fas fa-exclamation-triangle icon" style="color: #dc3545;"></i>
                    <h3>{{ total_penalty|floatformat:2 }}</h3>
                    <p>Penalty (TZS) <span class="visit-icon"><i class="fas fa-arrow-right"></i></span></p>
                </a>
            </div>
        </div>
        <hr class="my-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover table-sm mb-0">
                        <thead>
                            <tr>
                                <th class="text-center"><input type="checkbox" onclick="toggleAll(this)"></th>
                                <th>Plate</th>
                                <th>Ref</th>
                                <th>License</th>
                                <th>Offence</th>
                                <th>Charge (TZS)</th>
                                <th>Penalty (TZS)</th>
                                <th>Status</th>
                                <th>Paid</th>
                                <th>Date</th>
                                <th>Print</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for offense in page_obj %}
                            <tr>
                                <td class="text-center"><input type="checkbox" name="selected"></td>
                                <td>{{ offense.vehicle.plate_number }}</td>
                                <td>{{ offense.reference }}</td>
                                <td>{{ offense.license }}</td>
                                <td>{{ offense.offence }}</td>
                                <td>{{ offense.charge|floatformat:2 }}</td>
                                <td>{{ offense.penalty|floatformat:2 }}</td>
                                <td><span class="badge {% if offense.status == 'Pending' %}bg-warning text-dark{% else %}bg-success{% endif %}">{{ offense.status }}</span></td>
                                <td>{{ offense.is_paid|yesno:"Yes,No" }}</td>
                                <td>{{ offense.issued_date|date:"Y-m-d" }}</td>
                                <td><button class="btn btn-outline-primary btn-sm" onclick="printRow(this)"><i class="fas fa-print"></i></button></td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="11" class="text-center">No offenses found.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="pagination">
            <span class="step-links">
                {% if page_obj.has_previous %}
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page=1" class="custom-link"><i class="fas fa-angle-double-left"></i> First</a>
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}" class="custom-link"><i class="fas fa-angle-left"></i> Prev</a>
                {% endif %}
                <span style="color: #1877F2; font-weight: bold;">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </span>
                {% if page_obj.has_next %}
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" class="custom-link">Next <i class="fas fa-angle-right"></i></a>
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.paginator.num_pages }}" class="custom-link">Last <i class="fas fa-angle-double-right"></i></a>
                {% endif %}
            </span>
            <form method="get">
                {% for key, value in request.GET.items %}
                    {% if key != 'page' %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endif %}
                {% endfor %}
                <label for="page_input" style="font-weight: normal; font-size: 0.9em;">Go to page:</label>
                <input type="number" id="page_input" name="page" min="1" max="{{ page_obj.paginator.num_pages }}" value="{{ page_obj.number }}" required>
                <button type="submit"><i class="fas fa-arrow-right"></i></button>
            </form>
        </div>
    </main>
{% endblock %}